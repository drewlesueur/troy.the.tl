<!doctype html>
<html>
<head>
<link href='http://fonts.googleapis.com/css?family=Josefin+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet/less" type="text/css" href="styles.less">
<style>
  body {
    /*background-color: rgb(39,39,39);
    background-image: -webkit-gradient(radial, 500 25%, 20, 500 25%, 40, from(#000), to(rgb(39,39,39)));
    */
    

  }  
</style>
<script src="http://inc.the.tl/less.js" type="text/javascript"></script>
<script src="http://inc.the.tl/jquery.js"></script>
<script src="http://inc.the.tl/zepto/src/zepto.js"></script>
<script src="http://inc.the.tl/zepto/src/event.js"></script>
<script src="http://inc.the.tl/zepto/src/fx.js"></script>
<script src="http://inc.the.tl/zepto/src/detect.js"></script>

<script>
    $ = jQuery;
    z = Zepto;
</script>

<script src="http://inc.the.tl/jqueryui.js"></script>
<script src="http://inc.the.tl/underscore.js"></script>
<script src="http://inc.the.tl/coffeescript.js"></script>
<script src="http://inc.the.tl/k/index.js"></script>

<script type="text/coffeescript">

  #problem. instantiating should NOT append to the dom or the object
  if !window.console
    window.console = {}
  if !window.console.log
    window.console.log = () ->
  $(document).ready () ->

    #trying the Model View Presenter pattern

    #this is a rusty model... polish it. look to backbone as an example
    HomeModel = k.class
      initialize: (e) ->
      loadGalleries: (e) ->
        $.ajax
          type: "GET"
          url: "http://troybrinkerhoff.com/new2/galleries.php"
          dataType: "jsonp"
          success: (data) ->
            k(e).set "galleries": data 
            
    HomePresenter = k.class
      initialize: (e) ->
        e.model = k.new HomeModel
        model = e.model
        e.view = k.new HomeView
        view = e.view

        k(model).bind "change:galleries", (e) ->
          p(view).clearNavLinks()
          for gallery, info of model.galleries
            p(view).addNavLink k.capitalize(k(gallery).s("gallery_".length)), "#"
          
        k(view).bind "link", (e, linkName) ->
          if linkName is view.galleryState
            return
          view.galleryState = linkName
          p.clearThumbnails e
          p.slideThumbnails e, "out"
          p.slideBanner e, "down"
          gallery_name = "gallery_" + linkName.toLowerCase() 
          for image, index in model.galleries[gallery_name].images
            if k.s(image, -2) == "db" then return
            url = 
              big: image
              thumb: model.galleries[gallery_name].thumbs[index]
            p.addImage view, url 


        k(view).bind "homeclick", (e) ->
          view.galleryState = ""
          p.slideThumbnails e, "in"
          p.slideBanner e, "up"
          

        p(model).loadGalleries()

    HomeView = k.class
      #jquert binds and triggers can go in here
      initialize: (e, presenter) ->
        e.thumbsWidth = 200
        
        e.presenter = presenter 
        e.el = $('#home-wrapper')
        e.state = "home"
        $('#main-logo').click (event) ->
          k(e).trigger "homeclick"
      clearNavLinks: (e) ->
        e.el.find("#links").empty()
      addNavLink: (e, linkName, linkAddress) ->
        a = $ "<a href='#'>#{linkName}</a>"
        a.bind "click", (event) ->
          event.preventDefault();
          k(e).trigger "link", linkName
          
        e.el.find("#links").append a
      loadViewerImage: (e, url) ->
        $("#viewer-img").attr "src", url
      addImage: (e, urls) ->
        thumb = $("<img class='thumb' >")
        thumb.attr "src", urls.thumb
        thumb.bind "click", (event) ->
          p.loadViewerImage e, urls.big
          k(e).trigger "imageSelected", urls, thumb
        $("#thumbs").append thumb
      clearThumbnails: (e) ->
        $("#thumbs").empty()
      slideThumbnails: (e, outOrIn) ->
        if outOrIn == "out"
          translate = "-#{e.thumbsWidth}px"
          right = 0
        else
          translate = 0
          right = "-#{e.thumbsWidth}px"
        if z.browser.webkit
          z("#thumbs").anim({"translateX": translate})
        else
          $('#thumbs').animate({right: right})
      slideBanner: (e, upOrDown) ->
        if upOrDown is "down"
          translate = "50px"
          bottom = 0
        else
          translate = 0
          bottom = "50px"
        if z.browser.webit
          z("#banner").anim "translateY" : translate
        else
          $("#banner").animate "bottom" : bottom

    home = k.new HomePresenter
    
    return


    
</script>
</head>
<body>
  <div id="wrapper" align="center">
    <div id="home-wrapper">
      <div id="home-image"></div>
      <div id="viewer"><img id="viewer-img" src="blank.gif" /></div>
      <div id="slide"></div>
      <div id="thumbs"></div>

      <div id="banner">
        <span id="main-logo">Troy Brinkerhoff</span>
        <div id="links">
        </div>
      </div>  
    </div>
  </div>
</body>
</html>
