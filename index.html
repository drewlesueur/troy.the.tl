<!doctype html>
<html>
<head>
<style>

</style>  

<script src="http://inc.the.tl/jquery.js"></script>
<script src="http://inc.the.tl/zepto/src/zepto.js"></script>
<script src="http://inc.the.tl/zepto/src/event.js"></script>
<script src="http://inc.the.tl/zepto/src/fx.js"></script>
<script>
  $ = jQuery;
  z = Zepto;
</script>
<script src="http://inc.the.tl/jqueryui.js"></script>
<script src="http://inc.the.tl/underscore.js"></script>
<script src="http://inc.the.tl/coffeescript.js"></script>
<script src="http://inc.the.tl/k/index.js"></script>

<script type="text/coffeescript">
  #problem. instantiating should NOT append to the dom or the object
  $(document).ready () ->
    #trying the Model View Presenter pattern

    #this is a rusty model... polish it. look to backbone as an example
    HomeModel = k.class
      initialize: (e) ->
      loadGalleries: (e) ->
        console.log "fetching"
        $.ajax
          type: "GET"
          url: "http://troybrinkerhoff.com/new2/galleries.php"
          dataType: "jsonp"
          success: (data) ->
            k(e).set "galleries": data 
            
    HomePresenter = k.class
      initialize: (e) ->
        e.model = k.new HomeModel
        model = e.model
        e.view = k.new HomeView
        view = e.view

        k(model).bind "change:galleries", (e) ->
          p(view).clearNavLinks()
          for gallery, info of model.galleries
            p(view).addNavLink k(gallery).s("gallery_".length), "#"

        p(model).loadGalleries()
    HomeView = k.class
      #jquert binds and triggers can go in here
      initialize: (e) ->
        e.el = $('#home-wrapper')
      clearNavLinks: (e) ->
        e.el.find("#links").empty()
      addNavLink: (e, linkName, linkAddress) ->
        e.el.find("#links").append("""
            <a href="#">#{linkName}</a> 
        """)
        
    home = k.new HomePresenter
    
    return

    Home = k.class
      initialize: (e) ->
        m(e).view = k.new HomeView, model: e
        k(e).set "banner": k.new(Banner, parent: e)
         

    HomeView = k.class
      initialize: (e, options) ->
        e.el = $ "#home-wrapper"
        e.model = options.model
        console.log "trying to bind"
        k(e.model).bind "change:banner", (e) ->
          bannerView = m(e.banner).view
          p(bannerView).redraw()

    Banner = k.class
      initialize: (e, options) ->
        m(e).parent = options.parent
        m(e).view = k.new BannerView, model: e


    BannerView = k.class
      initialize: (e, options) ->
        e.el = $ "#banner"
      redraw: (e) ->
        $(e.el).empty()



    home = k.new Home
    home.links =
      Children : "#children"
      Teens : "#teens"
      Couples: "#couples"
      Families: "#families"
      Wedding: "#wedding"
      Other: "#other"


    
</script>
</head>
<body>
  <div id="home-wrapper">
    <div id="banner">
      <span id="main-logo">Troy Brinkerhoff</span>
      <div id="links">
        <a href="#">Test</a>
      </div>
    </div>  
  </div>
</body>
</html>
